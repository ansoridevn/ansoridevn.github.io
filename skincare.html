<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Skincare">
    <link rel="apple-touch-icon" href="https://images.unsplash.com/photo-1556228578-0d85b1a4d571?q=80&w=256&auto=format&fit=crop">

    <title>Jadwal Skincare Transisi</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,600;1,600&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #d17a8e;
            --text-dark: #4a3f3f;
            --text-muted: #7a6b6b;
            --bg-card: rgba(255, 255, 255, 0.75);
            --bg-card-rest: rgba(234, 245, 238, 0.85);
            --success-color: #6da27d;
            --warning-color: #e59866;
        }

        * {
            box-sizing: border-box; margin: 0; padding: 0;
            -webkit-user-select: none; user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body { background-color: #fceef1; font-family: 'Poppins', sans-serif; min-height: 100vh; min-height: -webkit-fill-available; }

        /* Container Utama (Mode Aktif / Default) */
        .iphone-frame {
            width: 100%; min-height: 100vh;
            background: linear-gradient(rgba(255, 245, 247, 0.8), rgba(255, 245, 247, 0.9)), 
                        url('https://images.unsplash.com/photo-1490750967868-88aa4486c946?q=80&w=1000&auto=format&fit=crop');
            background-size: cover; background-position: center; background-attachment: fixed;
            padding: calc(40px + env(safe-area-inset-top)) 20px calc(40px + env(safe-area-inset-bottom));
            position: relative;
            transition: background 0.5s ease;
        }

        /* Container Mode Istirahat (Berubah otomatis via JS) */
        .iphone-frame.rest-mode {
            background: linear-gradient(rgba(234, 245, 238, 0.88), rgba(234, 245, 238, 0.95)), 
                        url('https://images.unsplash.com/photo-1518531933037-91b2f5f229cc?q=80&w=1000&auto=format&fit=crop');
            background-size: cover; background-position: center; background-attachment: fixed;
        }

        h1 { font-family: 'Playfair Display', serif; font-size: 28px; color: var(--text-dark); text-align: center; margin-bottom: 5px; line-height: 1.2; }
        
        /* Progress Bar Baru */
        .progress-container { width: 100%; max-width: 250px; margin: 0 auto 20px; text-align: center; }
        .progress-text { font-size: 11px; color: var(--text-muted); margin-bottom: 5px; font-weight: 500;}
        .progress-bar-bg { width: 100%; height: 6px; background: rgba(0,0,0,0.1); border-radius: 10px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--success-color); width: 0%; transition: width 0.4s ease; }

        /* Keterangan */
        .legend-container {
            background: rgba(255, 255, 255, 0.6); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            border-radius: 15px; padding: 15px; margin-bottom: 25px; font-size: 11px; color: var(--text-dark); border: 1px solid rgba(255, 255, 255, 0.8);
        }
        .legend-item { display: flex; align-items: center; margin-bottom: 6px; }
        .legend-item:last-child { margin-bottom: 0; }
        .emoji-icon { font-size: 16px; margin-right: 8px; width: 20px; text-align: center; }

        /* Grid & Card */
        .calendar-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .day-card {
            background: var(--bg-card); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
            border-radius: 12px; padding: 12px 8px; text-align: center; border: 1px solid rgba(255, 255, 255, 0.9);
            box-shadow: 0 4px 10px rgba(0,0,0,0.03); display: flex; flex-direction: column; justify-content: center; min-height: 80px; transition: all 0.2s ease; position: relative; cursor: pointer;
        }
        .day-card:active { transform: scale(0.95); }
        .day-card.rest-day { background: var(--bg-card-rest); border: 1px solid rgba(168, 218, 181, 0.4); }
        .day-card.is-done { border: 2px solid var(--success-color); background: rgba(240, 255, 240, 0.8); opacity: 0.85; }
        .done-badge { position: absolute; top: -6px; right: -6px; background: var(--success-color); color: white; width: 20px; height: 20px; border-radius: 50%; font-size: 12px; display: flex; justify-content: center; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .date { font-family: 'Playfair Display', serif; font-size: 14px; font-weight: 600; color: var(--text-dark); margin-bottom: 6px; border-bottom: 1px solid rgba(0,0,0,0.05); padding-bottom: 4px; }
        .action { font-size: 10px; font-weight: 500; color: var(--text-muted); line-height: 1.4; }
        .action-emojis { font-size: 14px; margin-bottom: 2px; }
        .footer-note { text-align: center; font-size: 10px; color: var(--text-muted); margin-top: 30px; font-style: italic; }

        /* Highlight Hari Ini */
        .day-card.today-highlight { border: 2px solid var(--primary-color); box-shadow: 0 0 15px rgba(209, 122, 142, 0.5); transform: scale(1.05); background: rgba(255, 255, 255, 0.95); z-index: 1; }
        .today-highlight .date { color: var(--primary-color); }

        /* Mode Istirahat Highlight Warna Hijau */
        .iphone-frame.rest-mode .day-card.today-highlight { border: 2px solid var(--success-color); box-shadow: 0 0 15px rgba(109, 162, 125, 0.5); }
        .iphone-frame.rest-mode .today-highlight .date { color: var(--success-color); }

        /* Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); backdrop-filter: blur(4px); -webkit-backdrop-filter: blur(4px); display: flex; justify-content: center; align-items: center; z-index: 100; opacity: 0; visibility: hidden; transition: all 0.3s ease; }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal-content { background: #fff; border-radius: 20px; padding: 25px 20px; width: 85%; max-width: 320px; text-align: center; box-shadow: 0 15px 30px rgba(0,0,0,0.15); transform: translateY(20px); transition: transform 0.3s ease; }
        .modal-overlay.active .modal-content { transform: translateY(0); }
        .modal-date { font-family: 'Playfair Display', serif; font-size: 22px; color: var(--primary-color); margin-bottom: 5px; }
        .modal-status { font-size: 14px; font-weight: 600; color: var(--text-dark); margin-bottom: 15px; }
        .modal-routine { background: #f9f9f9; border-radius: 12px; padding: 15px; text-align: left; margin-bottom: 20px; font-size: 12px; color: var(--text-muted); }
        .modal-routine strong { color: var(--text-dark); }
        .btn { display: block; width: 100%; padding: 12px; border-radius: 10px; border: none; font-family: 'Poppins', sans-serif; font-weight: 600; font-size: 13px; margin-bottom: 10px; cursor: pointer; transition: opacity 0.2s; }
        .btn-success { background: var(--success-color); color: #fff; }
        .btn-warning { background: var(--warning-color); color: #fff; }
        .btn-outline { background: transparent; color: var(--text-muted); border: 1px solid #ddd; }

        /* ================= INSTALL PROMPT SCREEN ================= */
        #installPrompt {
            display: none; /* Disembunyikan secara default */
            flex-direction: column; justify-content: center; align-items: center;
            height: 100vh; width: 100%; background: #fff; text-align: center; padding: 30px; z-index: 999;
        }
        #installPrompt h2 { font-family: 'Playfair Display', serif; color: var(--primary-color); margin-bottom: 15px; }
        #installPrompt p { font-size: 14px; color: var(--text-muted); margin-bottom: 30px; }
        .install-box { background: #f4f4f4; border-radius: 15px; padding: 20px; text-align: left; width: 100%; max-width: 300px; font-size: 13px; color: #333; line-height: 1.6; }
        .install-icon { display: inline-block; width: 24px; text-align: center; font-size: 18px; }
    </style>
</head>
<body>

<div id="installPrompt">
    <h2>üì± Tambahkan Aplikasi</h2>
    <p>Aplikasi Tracker ini dirancang khusus untuk layar utama iPhone kamu.</p>
    <div class="install-box">
        <strong>Cara Instal:</strong><br><br>
        1. Ketuk ikon <span class="install-icon">‚éô</span> (Share / Bagikan) di bagian bawah layar Safari.<br><br>
        2. Gulir ke bawah dan pilih <span class="install-icon">‚ûï</span> <strong>"Tambah ke Layar Utama"</strong> (Add to Home Screen).<br><br>
        3. Buka aplikasinya dari Home Screen kamu!
    </div>
</div>

<div class="iphone-frame" id="mainApp">
    <h1>Jadwal Transisi</h1>
    
    <div class="progress-container">
        <div class="progress-text" id="progressText">Progress Bulan Ini: 0 / 30 Selesai</div>
        <div class="progress-bar-bg">
            <div class="progress-fill" id="progressFill"></div>
        </div>
    </div>

    <div class="legend-container">
        <div class="legend-item"><span class="emoji-icon">‚òÄÔ∏è</span><span><strong>Pagi:</strong> BPO 2.5% + Sunscreen</span></div>
        <div class="legend-item"><span class="emoji-icon">üåô</span><span><strong>Malam:</strong> Pelembap ‚Üí Tretinoin ‚Üí Pelembap</span></div>
        <div class="legend-item"><span class="emoji-icon">üåø</span><span><strong>Istirahat:</strong> Hanya Basic Skincare</span></div>
    </div>

    <div class="calendar-grid" id="calendar"></div>
    <p class="footer-note">*Ketuk tanggal untuk melihat detail dan menandai selesai.*</p>
</div>

<div class="modal-overlay" id="routineModal">
    <div class="modal-content">
        <div class="modal-date" id="modalDateDisplay">Tgl Bulan</div>
        <div class="modal-status" id="modalStatusDisplay">Status Hari Ini</div>
        <div class="modal-routine" id="modalRoutineDetail"></div>
        <button class="btn btn-success" id="btnMarkDone">‚úÖ Tandai Selesai</button>
        <button class="btn btn-warning" id="btnForceRest">üöë Kulit Iritasi (Paksa Istirahat)</button>
        <button class="btn btn-outline" id="btnCloseModal">Tutup</button>
    </div>
</div>

<script>
    // 1. DETEKSI MODE STANDALONE (PWA)
    const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone || document.referrer.includes('android-app://');
    
    // Jika tidak diakses dari Home Screen, tampilkan panduan install dan sembunyikan aplikasi
    if (!isStandalone) {
        document.getElementById('installPrompt').style.display = 'flex';
        document.getElementById('mainApp').style.display = 'none';
    } else {
        // JALANKAN APLIKASI UTAMA
        initApp();
    }

    function initApp() {
        let skincareData = JSON.parse(localStorage.getItem('skincare_tracker_data')) || {};
        let activeSelectedDateKey = null; 

        const startDate = new Date(2026, 1, 28); 
        startDate.setHours(0, 0, 0, 0); 
        const today = new Date();
        today.setHours(0, 0, 0, 0);

        const diffTime = today.getTime() - startDate.getTime();
        const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
        const currentBlock = diffDays > 0 ? Math.floor(diffDays / 30) : 0;

        let displayStartDate = new Date(startDate);
        displayStartDate.setDate(startDate.getDate() + (currentBlock * 30));

        const calendarElement = document.getElementById('calendar');
        const monthNames = ["Jan", "Feb", "Mar", "Apr", "Mei", "Jun", "Jul", "Ags", "Sep", "Okt", "Nov", "Des"];

        function renderCalendar() {
            calendarElement.innerHTML = ''; 
            let totalDoneThisMonth = 0; // Untuk menghitung progress bar
            let isTodayRestMode = false; // Flag untuk mengubah background utama
            
            for (let i = 0; i < 30; i++) {
                let cardDate = new Date(displayStartDate);
                cardDate.setDate(displayStartDate.getDate() + i);

                const dateKey = `${cardDate.getFullYear()}-${(cardDate.getMonth()+1).toString().padStart(2, '0')}-${cardDate.getDate().toString().padStart(2, '0')}`;
                const dateDisplay = `${cardDate.getDate()} ${monthNames[cardDate.getMonth()]}`;
                const absoluteDayIndex = (currentBlock * 30) + i;

                let isRestDay = false;
                if (absoluteDayIndex < 14) { isRestDay = (absoluteDayIndex % 2 !== 0); } 
                else { isRestDay = (absoluteDayIndex % 3 === 0); }

                let dayData = skincareData[dateKey] || { done: false, forcedRest: false };
                if (dayData.forcedRest) { isRestDay = true; }
                if (dayData.done) { totalDoneThisMonth++; }

                const isToday = (cardDate.getTime() === today.getTime());
                
                // Deteksi apakah HARI INI adalah hari istirahat untuk mengubah background
                if (isToday && isRestDay) { isTodayRestMode = true; }

                const card = document.createElement('div');
                card.className = `day-card ${isRestDay ? 'rest-day' : ''} ${isToday ? 'today-highlight' : ''} ${dayData.done ? 'is-done' : ''}`;
                
                let badgeHTML = dayData.done ? `<div class="done-badge">‚úì</div>` : '';

                if (isRestDay) {
                    card.innerHTML = `${badgeHTML}<div class="date">${dateDisplay}</div><div class="action-emojis">üåø</div><div class="action">Istirahat</div>`;
                } else {
                    card.innerHTML = `${badgeHTML}<div class="date">${dateDisplay}</div><div class="action-emojis">‚òÄÔ∏è+üåô</div><div class="action">Aktif</div>`;
                }

                card.onclick = () => openModal(dateDisplay, dateKey, isRestDay, dayData);
                calendarElement.appendChild(card);
            }

            // Update Background UI jika hari ini istirahat
            const mainAppElement = document.getElementById('mainApp');
            if (isTodayRestMode) {
                mainAppElement.classList.add('rest-mode');
            } else {
                mainAppElement.classList.remove('rest-mode');
            }

            // Update Progress Bar
            document.getElementById('progressText').innerText = `Progress Bulan Ini: ${totalDoneThisMonth} / 30 Selesai`;
            document.getElementById('progressFill').style.width = `${(totalDoneThisMonth / 30) * 100}%`;
        }

        // FUNGSI MODAL (Tetap sama seperti sebelumnya)
        const modal = document.getElementById('routineModal');
        const modalDateDisplay = document.getElementById('modalDateDisplay');
        const modalStatusDisplay = document.getElementById('modalStatusDisplay');
        const modalRoutineDetail = document.getElementById('modalRoutineDetail');
        const btnMarkDone = document.getElementById('btnMarkDone');
        const btnForceRest = document.getElementById('btnForceRest');
        const btnCloseModal = document.getElementById('btnCloseModal');

        function openModal(dateDisplay, dateKey, isRestDay, dayData) {
            activeSelectedDateKey = dateKey; 
            modalDateDisplay.innerText = dateDisplay;
            
            if (isRestDay) {
                modalStatusDisplay.innerText = "üåø Hari Istirahat";
                modalRoutineDetail.innerHTML = "<strong>Pagi:</strong> Cuci muka, Pelembap, Sunscreen.<br><br><strong>Malam:</strong> Cuci muka, Pelembap (Tanpa bahan aktif).";
                btnForceRest.style.display = 'none'; 
            } else {
                modalStatusDisplay.innerText = "‚òÄÔ∏èüåô Hari Aktif";
                modalRoutineDetail.innerHTML = "<strong>Pagi:</strong> Cuci muka, Pelembap, Totol BPO HANYA di jerawat, Sunscreen.<br><br><strong>Malam:</strong> Sandwich Method (Pelembap ‚Üí Tretinoin tipis ‚Üí Pelembap).";
                btnForceRest.style.display = 'block'; 
            }

            if (dayData.done) {
                btnMarkDone.innerText = "‚ùå Batal Tandai Selesai";
                btnMarkDone.style.backgroundColor = "#e74c3c"; 
            } else {
                btnMarkDone.innerText = "‚úÖ Tandai Selesai";
                btnMarkDone.style.backgroundColor = "var(--success-color)";
            }
            modal.classList.add('active');
        }

        function closeModal() { modal.classList.remove('active'); activeSelectedDateKey = null; }

        btnMarkDone.onclick = () => {
            if (!skincareData[activeSelectedDateKey]) { skincareData[activeSelectedDateKey] = { done: false, forcedRest: false }; }
            skincareData[activeSelectedDateKey].done = !skincareData[activeSelectedDateKey].done;
            localStorage.setItem('skincare_tracker_data', JSON.stringify(skincareData));
            closeModal(); renderCalendar(); 
        };

        btnForceRest.onclick = () => {
            if(confirm("Jadwal hari ini akan diubah menjadi Hari Istirahat.")) {
                if (!skincareData[activeSelectedDateKey]) { skincareData[activeSelectedDateKey] = { done: false, forcedRest: false }; }
                skincareData[activeSelectedDateKey].forcedRest = true;
                localStorage.setItem('skincare_tracker_data', JSON.stringify(skincareData));
                closeModal(); renderCalendar();
            }
        };

        btnCloseModal.onclick = closeModal;
        modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });

        renderCalendar();
    }
</script>

</body>
</html>
